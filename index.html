<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時間割シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body class="bg-slate-50 text-slate-900 font-sans">

    <div class="max-w-7xl mx-auto p-4 lg:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800">Timetable Simulator <span
                    class="text-sm font-normal text-slate-500">2025 Edition</span></h1>
            <p class="text-slate-600">自分だけの時間割をシミュレーション。選択した講義はブラウザに自動保存されます。</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-12 landscape:grid-cols-12 gap-8">
            <!-- Sidebar (Top on mobile portrait, Left on PC/Landscape) -->
            <div class="md:col-span-4 landscape:col-span-4 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-end mb-2">
                        <label class="block text-sm font-bold">期間を選択 (複数選択可)</label>
                        <label class="flex items-center cursor-pointer text-xs text-slate-600 hover:text-slate-800">
                            <input type="checkbox" id="strictModeToggle" class="mr-1 accent-blue-600"
                                onchange="if(window.toggleStrictMode) window.toggleStrictMode()">
                            <span>厳密モード</span>
                        </label>
                    </div>

                    <!-- Term Filters (Multi-Select Toggles) -->
                    <div class="flex flex-wrap gap-2 mb-4" id="termButtons">
                        <button onclick="if(window.toggleSemester) window.toggleSemester('前期')" data-term="前期"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">前期</button>
                        <button onclick="if(window.toggleSemester) window.toggleSemester('後期')" data-term="後期"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">後期</button>
                        <button onclick="if(window.toggleTerm) window.toggleTerm('T1')" data-term="T1"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">T1</button>
                        <button onclick="if(window.toggleTerm) window.toggleTerm('T2')" data-term="T2"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">T2</button>
                        <button onclick="if(window.toggleTerm) window.toggleTerm('T3')" data-term="T3"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">T3</button>
                        <button onclick="if(window.toggleTerm) window.toggleTerm('T4')" data-term="T4"
                            class="term-btn px-3 py-1 rounded-full text-sm font-medium transition-colors border">T4</button>
                    </div>

                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-bold">講義を検索</label>
                        <button onclick="if(window.resetTimetable) window.resetTimetable()"
                            class="text-xs text-red-500 border border-red-200 px-2 py-1 rounded hover:bg-red-50 transition-colors">
                            リセット
                        </button>
                    </div>
                    <input type="text" id="searchInput" placeholder="科目名、教員名で検索..."
                        class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none mb-4">

                    <!-- Advanced Filters -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <select id="deptFilter" class="p-2 border border-slate-300 rounded-lg text-sm">
                            <option value="">所属 (全て)</option>
                            <!-- Populated dynamically -->
                        </select>
                        <select id="gradeFilter" class="p-2 border border-slate-300 rounded-lg text-sm">
                            <option value="">年次 (全て)</option>
                            <option value="1">1年</option>
                            <option value="2">2年</option>
                            <option value="3">3年</option>
                            <option value="4">4年</option>
                            <option value="5">5年</option>
                            <option value="6">6年</option>
                        </select>
                        <select id="dayFilter" class="p-2 border border-slate-300 rounded-lg text-sm">
                            <option value="">曜日 (全て)</option>
                            <option value="1">月</option>
                            <option value="2">火</option>
                            <option value="3">水</option>
                            <option value="4">木</option>
                            <option value="5">金</option>
                            <option value="6">土</option>
                        </select>
                        <select id="periodFilter" class="p-2 border border-slate-300 rounded-lg text-sm">
                            <option value="">時限 (全て)</option>
                            <option value="1">1限</option>
                            <option value="2">2限</option>
                            <option value="3">3限</option>
                            <option value="4">4限</option>
                            <option value="5">5限</option>
                            <option value="6">6限</option>
                        </select>
                    </div>

                    <div id="resultsCount" class="text-xs text-slate-400 mb-2"></div>
                    <div id="searchResults" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    </div>
                </div>
            </div>

            <!-- Main Content (Bottom on mobile portrait, Right on PC/Landscape) -->
            <div class="md:col-span-8 landscape:col-span-8">
                <!-- Tab Navigation -->
                <div class="flex justify-between items-end mb-0 border-b border-slate-200">
                    <div id="tabContainer" class="flex gap-2">
                        <!-- Tabs will be injected here -->
                    </div>
                    <div class="flex gap-2 pb-1">
                        <button onclick="if(window.generateShareUrl) window.generateShareUrl()"
                            class="text-xs flex items-center gap-1 bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded transition-colors"
                            title="URLで共有">
                            <span>🔗</span> 共有
                        </button>
                        <button onclick="if(window.printTimetable) window.printTimetable()"
                            class="text-xs flex items-center gap-1 bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded transition-colors"
                            title="印刷 / PDF保存">
                            <span>️🍎</span> 保存/印刷
                        </button>
                        <button onclick="if(window.exportToImage) window.exportToImage()"
                            class="text-xs flex items-center gap-1 bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded transition-colors"
                            title="画像として保存">
                            <span>📷</span> 画像保存
                        </button>
                    </div>
                </div>

                <!-- Added overflow-x-auto for horizontal scrolling on small screens -->
                <div
                    class="bg-white rounded-b-2xl rounded-tr-2xl shadow-sm border border-slate-200 overflow-x-auto border-t-0">
                    <table class="w-full min-w-[600px] table-fixed border-collapse">
                        <thead>
                            <tr class="bg-slate-100 border-b border-slate-200">
                                <th class="w-12 py-4"></th>
                                <th class="py-4 font-bold">月</th>
                                <th class="py-4 font-bold">火</th>
                                <th class="py-4 font-bold">水</th>
                                <th class="py-4 font-bold">木</th>
                                <th class="py-4 font-bold">金</th>
                            </tr>
                        </thead>
                        <tbody id="timetableGrid">
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 p-4 bg-blue-50 text-blue-800 rounded-xl text-sm italic">
                    ※ 選択した講義が重なっている場合は赤く表示されます。
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto relative">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">画像として保存</h2>
                <button onclick="document.getElementById('exportModal').classList.add('hidden')"
                    class="text-slate-400 hover:text-slate-600">
                    ✕
                </button>
            </div>
            <div class="flex justify-center mb-4 bg-slate-100 p-4 rounded-xl">
                <img id="exportImage" class="max-w-full shadow-lg border border-slate-200" alt="Timetable">
            </div>
            <div class="text-center">
                <p class="text-sm text-slate-500 mb-4">画像を長押しまたは右クリックして保存してください。</p>
                <button onclick="document.getElementById('exportModal').classList.add('hidden')"
                    class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg font-bold transition-colors">
                    閉じる
                </button>
            </div>
        </div>
    </div>

    <!-- Main Entry Point -->
    <script type="module" src="./js/main.js"></script>

</body>

</html>